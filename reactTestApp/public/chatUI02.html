<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HTML Chat Editor</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      height: 100vh;
    }

    .container {
      display: flex;
      height: 100vh;
      background: #f3f4f6;
    }

    .panel {
      display: flex;
      flex-direction: column;
      width: 33.333%;
    }

    .panel-header {
      padding: 16px;
      border-bottom: 1px solid #e5e7eb;
      font-size: 20px;
      font-weight: bold;
      color: white;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .chat-panel {
      background: white;
      border-right: 1px solid #e5e7eb;
    }

    .chat-panel .panel-header {
      background: linear-gradient(to right, #2563eb, #1d4ed8);
    }

    .html-panel {
      background: #f9fafb;
      border-right: 1px solid #e5e7eb;
    }

    .html-panel .panel-header {
      background: #1f2937;
    }

    .preview-panel {
      background: white;
    }

    .preview-panel .panel-header {
      background: linear-gradient(to right, #16a34a, #15803d);
    }

    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .message {
      display: flex;
    }

    .message.user {
      justify-content: flex-end;
    }

    .message.assistant {
      justify-content: flex-start;
    }

    .message-content {
      max-width: 80%;
      padding: 12px;
      border-radius: 8px;
    }

    .message.user .message-content {
      background: #2563eb;
      color: white;
    }

    .message.assistant .message-content {
      background: #e5e7eb;
      color: #1f2937;
    }

    .loading-dots {
      display: flex;
      gap: 4px;
    }

    .loading-dot {
      width: 8px;
      height: 8px;
      background: #6b7280;
      border-radius: 50%;
      animation: bounce 1.4s infinite ease-in-out both;
    }

    .loading-dot:nth-child(1) {
      animation-delay: -0.32s;
    }

    .loading-dot:nth-child(2) {
      animation-delay: -0.16s;
    }

    @keyframes bounce {
      0%, 80%, 100% {
        transform: scale(0);
      }
      40% {
        transform: scale(1);
      }
    }

    .chat-input-area {
      padding: 16px;
      border-top: 1px solid #e5e7eb;
      display: flex;
      gap: 8px;
    }

    .chat-input {
      flex: 1;
      padding: 8px 16px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      font-size: 14px;
      outline: none;
    }

    .chat-input:focus {
      border-color: #2563eb;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .send-button {
      padding: 8px 16px;
      background: #2563eb;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.2s;
    }

    .send-button:hover {
      background: #1d4ed8;
    }

    .send-button:disabled {
      background: #9ca3af;
      cursor: not-allowed;
    }

    .html-editor {
      flex: 1;
      padding: 16px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      background: #1f2937;
      color: #10b981;
      border: none;
      resize: none;
      outline: none;
    }

    .preview-frame {
      flex: 1;
      width: 100%;
      border: none;
      background: white;
    }

    .icon {
      width: 20px;
      height: 20px;
    }

    .image-button {
        padding: 8px;
        background: #10b981;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background 0.2s;
        }

        .image-button:hover {
        background: #059669;
        }

        .image-preview {
        max-width: 200px;
        max-height: 200px;
        border-radius: 4px;
        margin-top: 8px;
        }

        .view-btn {
  background: #10b981;
  color: white;
  border: none;
  padding: 6px 10px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 12px;
}

.view-btn:hover {
  background: #059669;
}

/* View mode helpers */
.hidden {
  display: none !important;
}

.full {
  width: 66.666% !important;
}

        .hidden {
  display: none !important;
}

  </style>
</head>
<body>
  <div class="container">
    <div class="panel chat-panel">
      <div class="panel-header">
        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
        </svg>
        AI Assistant
      </div>
      
      <div class="chat-messages" id="chatMessages">
        <div class="message assistant">
          <div class="message-content">
            Hello! I can help you modify HTML code. Paste your HTML in the middle panel and tell me what changes you'd like to make.
          </div>
        </div>
      </div>

    <div class="chat-input-area">
    <input type="file" id="imageInput" accept="image/*" style="display: none;">
    <button id="imageButton" class="image-button" title="Upload image">
        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
        </svg>
    </button>
    <input type="text" id="chatInput" class="chat-input" placeholder="Ask me to modify the HTML...">
    <button id="sendButton" class="send-button">Send</button>
    </div>
    </div>

    <div class="panel html-panel">
      <div class="panel-header">
        <!-- <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path>
        </svg>
        HTML Input -->
        <span style="flex: 1; display: flex; align-items: center; gap: 8px;">
      <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path>
      </svg>
      HTML / Preview
    </span>

    <button id="toggleView" style="
      background: #10b981;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
    ">
      Show Preview
    </button>
      </div>
      <textarea id="htmlEditor" class="html-editor"><!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sample Page</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 40px;
      background: #f5f5f5;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Welcome to My Website</h1>
    <p>This is a sample HTML page. Ask me to modify it!</p>
  </div>
</body>
</html></textarea>
    </div>

    <div class="panel preview-panel">
      <div class="panel-header">
        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
        </svg>
        Preview
      </div>
      <iframe id="previewFrame" class="preview-frame"></iframe>
    </div>
  </div>

  <script>
    var chatMessages = document.getElementById('chatMessages');
var chatInput = document.getElementById('chatInput');
var sendButton = document.getElementById('sendButton');
var imageButton = document.getElementById('imageButton');
var imageInput = document.getElementById('imageInput');
var htmlEditor = document.getElementById('htmlEditor');
var previewFrame = document.getElementById('previewFrame');

var toggleButton = document.getElementById('toggleView');
var htmlPanel = document.querySelector('.html-panel');
var previewPanel = document.querySelector('.preview-panel');

var showingPreview = false;

toggleButton.addEventListener('click', function () {
  showingPreview = !showingPreview;

  if (showingPreview) {
    htmlPanel.classList.add('hidden');
    previewPanel.classList.remove('hidden');
    toggleButton.textContent = 'Show HTML';
  } else {
    previewPanel.classList.add('hidden');
    htmlPanel.classList.remove('hidden');
    toggleButton.textContent = 'Show Preview';
  }
});

var chatPanel = document.querySelector('.chat-panel');
var htmlPanel = document.querySelector('.html-panel');
var previewPanel = document.querySelector('.preview-panel');

var btnSplit = document.getElementById('btnSplit');
var btnHtml = document.getElementById('btnHtml');
var btnPreview = document.getElementById('btnPreview');

function resetLayout() {
  htmlPanel.classList.remove('hidden', 'full');
  previewPanel.classList.remove('hidden', 'full');
}

btnSplit.addEventListener('click', function () {
  resetLayout();
});

btnHtml.addEventListener('click', function () {
  resetLayout();
  previewPanel.classList.add('hidden');
  htmlPanel.classList.add('full');
});

btnPreview.addEventListener('click', function () {
  resetLayout();
  htmlPanel.classList.add('hidden');
  previewPanel.classList.add('full');
});



var isLoading = false;
var selectedImage = null;

function updatePreview() {
  var htmlContent = htmlEditor.value;
  var blob = new Blob([htmlContent], { type: 'text/html' });
  var url = URL.createObjectURL(blob);
  previewFrame.src = url;
}

htmlEditor.addEventListener('input', updatePreview);
updatePreview();

function addMessage(role, content, imageData) {
  var messageDiv = document.createElement('div');
  messageDiv.className = 'message ' + role;
  
  var contentDiv = document.createElement('div');
  contentDiv.className = 'message-content';
  contentDiv.textContent = content;
  
  if (imageData) {
    var img = document.createElement('img');
    img.src = imageData;
    img.className = 'image-preview';
    contentDiv.appendChild(img);
  }
  
  messageDiv.appendChild(contentDiv);
  chatMessages.appendChild(messageDiv);
  chatMessages.scrollTop = chatMessages.scrollHeight;
}

function showLoading() {
  var messageDiv = document.createElement('div');
  messageDiv.className = 'message assistant';
  messageDiv.id = 'loadingMessage';
  
  var contentDiv = document.createElement('div');
  contentDiv.className = 'message-content';
  contentDiv.innerHTML = '<div class="loading-dots"><div class="loading-dot"></div><div class="loading-dot"></div><div class="loading-dot"></div></div>';
  
  messageDiv.appendChild(contentDiv);
  chatMessages.appendChild(messageDiv);
  chatMessages.scrollTop = chatMessages.scrollHeight;
}

function removeLoading() {
  var loadingMsg = document.getElementById('loadingMessage');
  if (loadingMsg) {
    loadingMsg.remove();
  }
}

imageButton.addEventListener('click', function() {
  imageInput.click();
});

imageInput.addEventListener('change', function(e) {
  var file = e.target.files[0];
  if (file) {
    var reader = new FileReader();
    reader.onload = function(event) {
      selectedImage = event.target.result;
      chatInput.placeholder = 'Describe what you want based on this image...';
    };
    reader.readAsDataURL(file);
  }
});

async function getAIResponse(userMessage, currentHTML, imageData) {
  const response = await fetch("http://localhost:3001/api/chat", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      message: userMessage,
      html: currentHTML,
      image: imageData
    })
  });

  if (!response.ok) {
    throw new Error("API error");
  }

  const data = await response.json();
  return data.html;
}

function sendMessage() {
  var message = chatInput.value.trim();
  if ((!message && !selectedImage) || isLoading) return;

  var displayMessage = message || 'Create HTML based on this image';
  addMessage('user', displayMessage, selectedImage);
  
  chatInput.value = '';
  chatInput.placeholder = 'Ask me to modify the HTML...';
  
  isLoading = true;
  sendButton.disabled = true;
  showLoading();

  var currentHTML = htmlEditor.value;
  var imageToSend = selectedImage;
  selectedImage = null;
  imageInput.value = '';
  
  getAIResponse(message, currentHTML, imageToSend).then(function(modifiedHTML) {
    removeLoading();
    addMessage('assistant', 'I have updated the HTML in the middle panel!');
    htmlEditor.value = modifiedHTML;
    updatePreview();
    isLoading = false;
    sendButton.disabled = false;
  }).catch(function(error) {
    removeLoading();
    addMessage('assistant', 'Sorry, I encountered an error. Please try again.');
    console.error('Error:', error);
    isLoading = false;
    sendButton.disabled = false;
  });
}

sendButton.addEventListener('click', sendMessage);
chatInput.addEventListener('keypress', function(e) {
  if (e.key === 'Enter') {
    e.preventDefault();
    sendMessage();
  }
});
  </script>
</body>
</html>